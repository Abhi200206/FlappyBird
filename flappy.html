<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>flappy bird</title>
</head>

<body>
    <div style="display: flex;justify-content: space-between;">
        <div style="display: flex;">
            <!-- <p>Count: </p> -->
            <p>Score: </p>
            <p id="count">0</p>
        </div>
        <div style="display: flex;">
            <p>High scrore:</p>
            <p id="high">0</p>
        </div>
    </div>
    <canvas id="canvas" style="width: 1200px; height: 500px; border: 1px solid black;">

    </canvas>

    <script>
        function mathRandom() {
            return Math.floor(Math.random() * 100);
        }
        function lost() {
            let hg = localStorage.getItem("hg") ? localStorage.getItem("hg") : 0;
            let count = document.getElementById("count").innerHTML;
            localStorage.setItem("hg", Math.max(document.getElementById("count").innerHTML, hg));
            alert(`your score : ${document.getElementById("count").innerHTML} || high score : ${localStorage.getItem("hg")}`);
            document.getElementById("count").innerHTML = 0;
            document.getElementById("high").innerHTML = Math.max(hg, count);
            let val = confirm("restart");
            if (val) {
                main();
            }
        }

        async function main() {
            let vel = 0;
            let acc = 9.8;
            let t1 = mathRandom(), t2 = mathRandom(), t3 = mathRandom();
            let y = 0, i = 0, j = -100, k = -200;
            let canvas = document.getElementById("canvas");
            let ctx = canvas.getContext("2d");
            let score = 0;
            document.onkeydown = () => {
                vel = -30;
            }
            while (true) {
                if (y > 500) {
                    lost();
                    return;
                }
                if (i > 310) {
                    i = 0;
                    t1 = mathRandom();
                }
                if (j > 310) {
                    j = 0;
                    t2 = mathRandom();
                }
                if (k > 310) {
                    k = 0;
                    t3 = mathRandom();
                }

                vel = vel + acc * 0.33;
                y = y + vel * 0.33;
                ctx.clearRect(0, 0, 1200, 500);
                ctx.beginPath();
                ctx.rect(10, y, 10, 10);
                ctx.fill();

                //towers 1
                ctx.beginPath();
                ctx.rect(300 - i, 0, 10, t1);
                ctx.fill();

                ctx.beginPath();
                ctx.rect(300 - i, t1 + 80, 10, 100);
                ctx.fill();


                //tower 2
                ctx.beginPath();
                ctx.rect(300 - j, 0, 10, t2);
                ctx.fill();

                ctx.beginPath();
                ctx.rect(300 - j, t2 + 80, 10, 100);
                ctx.fill();


                //tower 3

                ctx.beginPath();
                ctx.rect(300 - k, 0, 10, t3);
                ctx.fill();

                ctx.beginPath();
                ctx.rect(300 - k, t3 + 80, 10, 100);
                ctx.fill();
                i++;
                j++;
                k++;
                if (i >= 280 || j >= 280 || k >= 280) {

                    if (i >= 280) {
                        if (y <= t1 || y >= t1 + 80) {
                            lost();
                            break;
                        }
                    }
                    if (j >= 280) {
                        if (y <= t2 || y >= t2 + 80) {
                            lost();
                            break;
                        }
                    }
                    if (k >= 280) {
                        if (y <= t3 || y >= t3 + 80) {
                            lost();
                            break;
                        }
                    }
                    score++;
                    document.getElementById("count").innerHTML = parseInt(score / 32);
                }

                await new Promise((resolve, reject) => {
                    setTimeout(() => {
                        resolve(3);
                    }, 0.03333 * 1000);
                })
            };
        }
        main();
    </script>
</body>

</html>